dbtprs() { HOURS=${1:-24}; PR_LIMIT=${2:-$(expr $HOURS \* 10)}; CUTOFF=$(perl -e "print time() - ${HOURS}*3600;"); gh pr list -L${PR_LIMIT} -s all --json files,state,updatedAt,url,title,author | jq --arg cutoff "$CUTOFF" '.[] | select((.updatedAt | fromdateiso8601) > ($cutoff | tonumber)) | select(.files[].path | test("discord_dbt/dbt/models")) | {PR: (.title + " (" + .url + ") " + .state), author: (.author.login + " (updated " + .updatedAt + ")"), files: [.files[].path]}' | jq -s 'group_by(.PR) | map({PR: .[0].PR, author: .[0].author, files: map(.files) | add | unique})'; }

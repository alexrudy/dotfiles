#!/usr/bin/env python3.3
#
#  mov2mp4
#  bin
#
#  Created by Alexander Rudy on 2014-08-23.
#  Copyright 2014 Alexander Rudy. All rights reserved.
#

"""
Use ffmpeg to convert movie files (guessed input) to x264 mp4 format
"""

import os, os.path
import six
import subprocess

def convert_mov_to_mp4(input_file, output_file):
    """Convert a .mov to a .mp4"""
    args = ['ffmpeg', '-i', input_file, '-vcodec', 'libx264', output_file ]
    subprocess.call(args)
    
def main():
    """Convert a movie to mp4"""
    import argparse
    parser = argparse.ArgumentParser(description="Convert movies to mp4.", epilog=__doc__)
    parser.add_argument('input_file', type=six.text_type, help='input filename')
    parser.add_argument('output_file', nargs='?', type=six.text_type, help='output filename')
    parser.add_argument('--open', action='store_true', help='open output file')
    args = parser.parse_args()
    
    if args.output_file is None:
        basename, ext = os.path.splitext(args.input_file)
        args.output_file = basename + '.mp4'
    
    convert_mov_to_mp4(args.input_file, args.output_file)
    
    if args.open:
        subprocess.check_call(['open', args.output_file])
    
if __name__ == '__main__':
    main()
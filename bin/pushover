#!/usr/bin/env python
#
#  pushover
#  Send yourself notifications via https://pushover.net
#  Just set your pushover user ID to PUSHOVER_USER_ID
#  and your application API token to PUSHOVER_API_TOKEN
#  then call this script with the message you want to
#  send::
#  
#  $ make test; pushover "make test finished!"
#
#  Copyright 2017 Alexander Rudy. All rights reserved.
#

import sys
import os
import requests
import click

USER = os.environ['PUSHOVER_USER_ID']
API = os.environ['PUSHOVER_API_TOKEN']

def send_message(text):
    """Send a message"""
    payload = {"message": text, "user": USER, "token": API }
    r = requests.post('https://api.pushover.net/1/messages.json', data=payload, headers={'User-Agent': 'Python'})
    return r
    
@click.command()
@click.option("-s", "--status", type=int, help="Status of previous command.", default=None)
@click.argument("message", nargs=-1)
def main(status, message):
    """Main function for this script."""
    
    message = " ".join(message)
    if status is not None:
        if status == 0:
            message += " Success!"
        else:
            message += " Failed ({0:d})!".format(status)
    
    r = send_message(message)
    if not r.status_code == 200:
        print(r.text)
    
if __name__ == '__main__':
    main()